<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Retirement Income Planner — Wealth Builder</title>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { background: #1A237E; min-height: 100%; }
    body { font-family: 'Inter', -apple-system, sans-serif; min-height: 100%; background: linear-gradient(180deg, #0D1B4B 0%, #1A237E 100%); color: #fff; }
    input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 6px; border-radius: 9999px; background: rgba(255,255,255,0.2); outline: none; cursor: pointer; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #D4AF37; cursor: pointer; border: 2px solid #0D1B4B; box-shadow: 0 2px 6px rgba(212,175,55,0.5); }
    input[type="range"]::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: #D4AF37; cursor: pointer; border: 2px solid #0D1B4B; }
    .card { background: rgba(255,255,255,0.09); border: 1px solid rgba(255,255,255,0.15); border-radius: 16px; padding: 28px; }
    .val-badge { display: inline-block; background: rgba(212,175,55,0.15); color: #D4AF37; border: 1px solid rgba(212,175,55,0.4); border-radius: 20px; padding: 4px 14px; font-size: 0.875rem; font-weight: 700; }
    .result-card { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 16px; text-align: center; }
    .result-card .label { font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; }
    .result-card .value { font-size: 1.1rem; font-weight: 700; color: #fff; }
    .results-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-top: 16px; }
    .meter-bar-wrap { background: rgba(255,255,255,0.1); border-radius: 9999px; height: 20px; overflow: hidden; margin: 12px 0; }
    .meter-bar { height: 100%; border-radius: 9999px; transition: width 0.6s ease, background 0.6s ease; }
    .toggle-wrap { display: flex; align-items: flex-start; gap: 12px; cursor: pointer; }
    .toggle-track { width: 44px; height: 24px; border-radius: 12px; background: rgba(255,255,255,0.2); position: relative; flex-shrink: 0; transition: background 0.2s; }
    .toggle-thumb { position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: #fff; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.3); transition: transform 0.2s; }
    table { border-collapse: collapse; width: 100%; font-size: 0.85rem; }
    th { background: rgba(212,175,55,0.15); color: #D4AF37; padding: 10px 12px; text-align: right; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
    th:first-child { text-align: center; }
    td { padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.07); color: rgba(255,255,255,0.8); text-align: right; }
    td:first-child { text-align: center; font-weight: 600; }
    .section { padding: 32px 16px; max-width: 720px; margin: 0 auto; }
    hr { border: none; border-top: 1px solid rgba(255,255,255,0.1); margin: 24px 0; }
    @keyframes pulse-gold { 0%,100%{opacity:1;} 50%{opacity:0.6;} }
    @media (max-width: 640px) { .results-grid-3 { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav style="background:#0D1B4B;height:64px;display:flex;align-items:center;padding:0 20px;border-bottom:1px solid rgba(212,175,55,0.2);position:sticky;top:0;z-index:10;">
    <div style="display:flex;align-items:center;justify-content:space-between;width:100%;max-width:720px;margin:0 auto;">
      <a href="../index.html" style="display:flex;align-items:center;gap:8px;text-decoration:none;">
        <i class="ph ph-chart-line-up" style="color:#D4AF37;font-size:1.5rem;"></i>
        <span style="color:#D4AF37;font-weight:700;font-size:1.1rem;">Wealth Builder</span>
      </a>
      <span style="color:rgba(255,255,255,0.5);font-size:0.85rem;">Retirement Income Planner</span>
    </div>
  </nav>

  <!-- Hero -->
  <div style="text-align:center;padding:40px 16px 24px;">
    <div style="max-width:720px;margin:0 auto;">
      <div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:12px;">
        <i class="ph ph-arrows-counter-clockwise" style="color:#D4AF37;font-size:2rem;"></i>
        <h1 style="font-size:1.8rem;font-weight:800;color:#fff;letter-spacing:-0.3px;">Retirement Income Planner (SWP)</h1>
      </div>
      <p style="color:rgba(255,255,255,0.6);font-size:0.95rem;">Know exactly how long your retirement corpus will last with different withdrawal scenarios.</p>
    </div>
  </div>

  <!-- Main Section -->
  <section class="section" style="padding-top:0;">

    <!-- Sliders Card -->
    <div class="card">

      <!-- Initial Corpus -->
      <div style="margin-bottom:24px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label style="font-size:0.875rem;font-weight:600;color:rgba(255,255,255,0.9);">Initial Corpus (Rs.)</label>
          <span id="corpusVal" class="val-badge">Rs. 20,00,000</span>
        </div>
        <input type="range" id="corpus" min="100000" max="50000000" step="100000" value="2000000">
        <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:0.75rem;color:rgba(255,255,255,0.4);"><span>Rs. 1,00,000</span><span>Rs. 5,00,00,000</span></div>
      </div>

      <!-- Monthly Withdrawal -->
      <div style="margin-bottom:24px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label style="font-size:0.875rem;font-weight:600;color:rgba(255,255,255,0.9);">Monthly Withdrawal (Rs.)</label>
          <span id="withdrawalVal" class="val-badge">Rs. 20,000</span>
        </div>
        <input type="range" id="withdrawal" min="1000" max="200000" step="1000" value="20000">
        <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:0.75rem;color:rgba(255,255,255,0.4);"><span>Rs. 1,000</span><span>Rs. 2,00,000</span></div>
      </div>

      <!-- Annual Return -->
      <div style="margin-bottom:8px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <label style="font-size:0.875rem;font-weight:600;color:rgba(255,255,255,0.9);">Expected Annual Return (%)</label>
          <span id="rateVal" class="val-badge">8%</span>
        </div>
        <input type="range" id="rate" min="1" max="20" step="0.5" value="8">
        <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:0.75rem;color:rgba(255,255,255,0.4);"><span>1%</span><span>20%</span></div>
      </div>

      <!-- Inflation Toggle -->
      <div style="margin-top:16px;">
        <label class="toggle-wrap">
          <div style="position:relative;flex-shrink:0;">
            <input type="checkbox" id="inflationToggle" style="position:absolute;opacity:0;width:0;height:0;">
            <div id="inflationTrack" class="toggle-track"></div>
            <div id="inflationThumb" class="toggle-thumb"></div>
          </div>
          <div>
            <div style="font-size:0.875rem;font-weight:600;color:#fff;">Show Inflation Impact</div>
            <div style="font-size:0.75rem;color:rgba(255,255,255,0.5);margin-top:2px;">Adjust withdrawal for inflation over time.</div>
          </div>
        </label>
        <div id="inflationSection" style="display:none;margin-top:16px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <label style="font-size:0.875rem;font-weight:600;color:rgba(255,255,255,0.9);">Annual Inflation Rate (%)</label>
            <span id="inflationVal" style="display:inline-block;background:rgba(217,119,6,0.2);color:#FCD34D;border:1px solid rgba(217,119,6,0.4);border-radius:20px;padding:4px 14px;font-size:0.875rem;font-weight:700;">6%</span>
          </div>
          <input type="range" id="inflation" min="1" max="15" step="0.5" value="6">
          <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:0.75rem;color:rgba(255,255,255,0.4);"><span>1%</span><span>15%</span></div>
        </div>
      </div>

      <hr>

      <!-- Sustainability Meter -->
      <div id="sustainabilitySection" style="margin-top:8px;">
        <h3 style="font-size:1rem;font-weight:700;color:#D4AF37;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
          <i class="ph ph-gauge"></i> Sustainability Meter
        </h3>
        <div id="sustainabilityDisplay" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:20px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <span style="font-size:0.8rem;color:rgba(255,255,255,0.5);">Corpus Duration</span>
            <span id="meterLabel" style="font-size:0.8rem;font-weight:600;color:rgba(255,255,255,0.7);">—</span>
          </div>
          <div class="meter-bar-wrap">
            <div id="meterBar" class="meter-bar" style="width:0%;background:#EF4444;"></div>
          </div>
          <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:rgba(255,255,255,0.4);margin-bottom:12px;">
            <span>0 yrs</span><span>10 yrs</span><span>20 yrs</span><span>30 yrs</span><span>50+ yrs</span>
          </div>
          <div id="durationDisplay" style="text-align:center;padding:16px;border-radius:10px;background:rgba(255,255,255,0.05);">
            <div id="durationText" style="font-size:1.8rem;font-weight:800;color:#D4AF37;margin-bottom:4px;">—</div>
            <div id="durationSubtext" style="font-size:0.85rem;color:rgba(255,255,255,0.6);">—</div>
          </div>
        </div>
      </div>

      <!-- Results Grid -->
      <div class="results-grid-3" style="margin-top:20px;">
        <div class="result-card">
          <div class="label">Monthly Withdrawal</div>
          <div class="value" id="withdrawalDisplay">—</div>
        </div>
        <div class="result-card">
          <div class="label">Total Withdrawn</div>
          <div class="value" id="totalWithdrawn" style="color:#34D399;">—</div>
        </div>
        <div class="result-card" style="background:linear-gradient(135deg,#B8860B,#D4AF37);border:none;">
          <div class="label" style="color:rgba(26,35,126,0.7);">Initial Corpus</div>
          <div class="value" style="color:#1A237E;" id="corpusDisplay">—</div>
        </div>
      </div>

    </div>

    <!-- Year-by-Year Table Card -->
    <div class="card" style="margin-top:24px;">
      <h6 style="color:#D4AF37;font-weight:700;margin-bottom:8px;">Year-by-Year Corpus Breakdown</h6>
      <p style="font-size:0.8rem;color:rgba(255,255,255,0.5);margin-bottom:16px;">Shows how your corpus evolves each year.</p>
      <div style="overflow-x:auto;border-radius:12px;border:1px solid rgba(255,255,255,0.1);">
        <table>
          <thead><tr>
            <th>Year</th>
            <th>Opening Corpus</th>
            <th>Interest Earned</th>
            <th>Amount Withdrawn</th>
            <th>Closing Corpus</th>
          </tr></thead>
          <tbody id="corpusTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Back link -->
    <div style="text-align:center;margin-top:32px;">
      <a href="../index.html" style="color:rgba(212,175,55,0.8);text-decoration:none;font-size:0.875rem;font-weight:600;display:inline-flex;align-items:center;gap:6px;">
        <i class="ph ph-arrow-left"></i> Back to All Calculators
      </a>
    </div>

  </section>

  <!-- Footer -->
  <footer style="background:#0D1B4B;border-top:1px solid rgba(212,175,55,0.2);padding:20px;text-align:center;color:rgba(255,255,255,0.5);font-size:0.8rem;margin-top:32px;">
    © 2026 Wealth Builder — Licensed under <a href="../../LICENSE" style="color:#D4AF37;text-decoration:none;">MIT License</a>. Free to reuse with attribution.
  </footer>

  <script src="../assets/js/app.js"></script>
  <script>
    // ── Core SWP Calculation ──────────────────────────────────────────────────
    function calculateSWP(corpus, monthlyWithdrawal, annualRate) {
      const r = annualRate / 100 / 12;
      // Corpus is truly indefinite only when monthly interest earned >= monthly withdrawal
      if (monthlyWithdrawal <= corpus * r) {
        return { months: 0, years: 0, remainingMonths: 0, totalWithdrawn: 0, isIndefinite: true };
      }
      // Use annuity formula for exact months to depletion: n = -ln(1 - C*r/W) / ln(1+r)
      // When r = 0, fall back to simple division: n = corpus / monthlyWithdrawal
      const n = r === 0
        ? corpus / monthlyWithdrawal
        : -Math.log(1 - (corpus * r) / monthlyWithdrawal) / Math.log(1 + r);
      const months = Math.ceil(n);
      const years = Math.floor(months / 12);
      const remainingMonths = months % 12;
      const totalWithdrawn = monthlyWithdrawal * months;
      return { months, years, remainingMonths, totalWithdrawn, isIndefinite: false };
    }

    // ── Meter Update ──────────────────────────────────────────────────────────
    function updateMeter(years, isIndefinite) {
      const bar = document.getElementById('meterBar');
      const label = document.getElementById('meterLabel');
      let pct, color, labelText;
      if (isIndefinite) {
        pct = 100; color = '#D4AF37'; labelText = '∞ Wealth Preservation';
      } else if (years >= 30) {
        pct = 90; color = '#D4AF37'; labelText = 'Excellent — 30+ years';
      } else if (years >= 20) {
        pct = 70; color = '#22C55E'; labelText = 'Good — 20-30 years';
      } else if (years >= 10) {
        pct = 45; color = '#EAB308'; labelText = 'Moderate — 10-20 years';
      } else {
        pct = Math.max(10, (years / 10) * 40); color = '#EF4444'; labelText = 'Low — under 10 years';
      }
      bar.style.width = pct + '%';
      bar.style.background = color;
      label.textContent = labelText;
      label.style.color = color;
    }

    // ── Render Corpus Table ───────────────────────────────────────────────────
    function renderCorpusTable(corpus, withdrawal, annualRate, maxYears) {
      const r = annualRate / 100 / 12;
      const tbody = document.getElementById('corpusTableBody');
      tbody.innerHTML = '';
      let currentCorpus = corpus;
      const limit = maxYears || 20;

      for (let y = 1; y <= limit; y++) {
        if (currentCorpus <= 0) break;
        const opening = currentCorpus;
        let interestEarned = 0;
        let totalYearWithdrawal = 0;

        for (let m = 0; m < 12; m++) {
          if (currentCorpus <= 0) break;
          const interest = currentCorpus * r;
          interestEarned += interest;
          currentCorpus = currentCorpus + interest - withdrawal;
          totalYearWithdrawal += withdrawal;
          if (currentCorpus < 0) {
            totalYearWithdrawal += currentCorpus;
            currentCorpus = 0;
          }
        }

        const closing = Math.max(0, Math.round(currentCorpus));
        const closingColor = closing === 0 ? '#F87171' : (closing > Math.round(opening) ? '#4ADE80' : 'rgba(255,255,255,0.85)');
        const tr = document.createElement('tr');
        tr.style.background = y % 2 === 0 ? 'rgba(255,255,255,0.03)' : 'transparent';
        tr.innerHTML =
          '<td style="color:#D4AF37;">Year ' + y + '</td>' +
          '<td>' + formatINR(Math.round(opening)) + '</td>' +
          '<td style="color:#4ADE80;">' + formatINR(Math.round(interestEarned)) + '</td>' +
          '<td style="color:#F87171;">−' + formatINR(Math.round(totalYearWithdrawal)) + '</td>' +
          '<td style="color:' + closingColor + ';font-weight:600;">' + (closing === 0 ? '—' : formatINR(closing)) + '</td>';
        tbody.appendChild(tr);
      }
    }

    // ── Main Calculate ────────────────────────────────────────────────────────
    function calculate() {
      const corpus     = parseFloat(document.getElementById('corpus').value);
      const withdrawal = parseFloat(document.getElementById('withdrawal').value);
      const annualRate = parseFloat(document.getElementById('rate').value);
      const inflation  = parseFloat(document.getElementById('inflation').value);

      // Update badges
      document.getElementById('corpusVal').textContent    = formatINR(corpus);
      document.getElementById('withdrawalVal').textContent = formatINR(withdrawal);
      document.getElementById('rateVal').textContent       = annualRate + '%';

      const result = calculateSWP(corpus, withdrawal, annualRate);

      // Meter
      updateMeter(result.years, result.isIndefinite);

      // Duration display
      const durationDisplay = document.getElementById('durationDisplay');
      const durationText    = document.getElementById('durationText');
      const durationSubtext = document.getElementById('durationSubtext');

      if (result.isIndefinite) {
        const monthlyRate     = annualRate / 100 / 12;
        const monthlyInterest = corpus * monthlyRate;
        const monthlySurplus  = monthlyInterest - withdrawal;
        durationDisplay.style.background = 'rgba(212,175,55,0.1)';
        durationText.textContent    = '∞';
        durationSubtext.textContent =
          'Monthly interest earned (' + formatINR(Math.round(monthlyInterest)) + ') > withdrawal (' +
          formatINR(withdrawal) + ') — corpus grows by ' + formatINR(Math.round(monthlySurplus)) + '/mo!';
      } else {
        durationDisplay.style.background = 'rgba(255,255,255,0.05)';
        const yrs = result.years > 0 ? result.years + ' yrs' : '';
        const mos = result.remainingMonths > 0 ? result.remainingMonths + ' mo' : '';
        durationText.textContent    = [yrs, mos].filter(Boolean).join(' ') || '< 1 mo';
        durationSubtext.textContent = 'Your corpus sustains your withdrawal for this duration.';
      }

      // Result cards
      document.getElementById('withdrawalDisplay').textContent = formatINR(withdrawal);
      document.getElementById('totalWithdrawn').textContent    = result.isIndefinite ? formatINR(withdrawal * 12) + '/yr' : formatINR(result.totalWithdrawn);
      document.getElementById('corpusDisplay').textContent     = formatINR(corpus);

      // Inflation note (reuse durationSubtext for inflation impact if enabled)
      if (document.getElementById('inflationToggle').checked && !result.isIndefinite) {
        const realLastYear = withdrawal / Math.pow(1 + inflation / 100, result.years);
        durationSubtext.textContent =
          'With ' + inflation + '% inflation, your ' + formatINR(withdrawal) +
          ' monthly withdrawal will have the purchasing power of ' +
          formatINR(realLastYear) + ' after ' + result.years + ' years.';
      }

      // Render table
      renderCorpusTable(corpus, withdrawal, annualRate, 20);
    }

    // ── Toggle Inflation ──────────────────────────────────────────────────────
    document.getElementById('inflationToggle').addEventListener('change', function () {
      const section = document.getElementById('inflationSection');
      const track   = document.getElementById('inflationTrack');
      const thumb   = document.getElementById('inflationThumb');
      if (this.checked) {
        section.style.display = 'block';
        track.style.background = '#D4AF37';
        thumb.style.transform  = 'translateX(20px)';
      } else {
        section.style.display = 'none';
        track.style.background = 'rgba(255,255,255,0.2)';
        thumb.style.transform  = '';
      }
      calculate();
    });

    // Make the toggle-wrap label clicks propagate correctly
    document.querySelector('.toggle-wrap').addEventListener('click', function (e) {
      if (e.target.tagName === 'INPUT') return;
      const cb = document.getElementById('inflationToggle');
      cb.checked = !cb.checked;
      cb.dispatchEvent(new Event('change'));
    });

    // ── Slider wiring ─────────────────────────────────────────────────────────
    ['corpus', 'withdrawal', 'rate', 'inflation'].forEach(function (id) {
      document.getElementById(id).addEventListener('input', calculate);
    });

    // Initial render
    calculate();
  </script>

</body>
</html>
